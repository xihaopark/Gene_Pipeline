# GenBank Gene Extractor 2.0 使用文档

## 项目简介

GenBank Gene Extractor 2.0 是一个强大的基因组数据处理工具，专门用于从 GenBank 数据库中提取基因信息。该工具支持三种主要工作模式：KEGG 批量搜索、本地文件管理和直接登录号搜索。

## 主要功能

### 1. KEGG 批量搜索
- 通过生物名称搜索 KEGG 数据库
- 批量下载多个基因组的 GenBank 文件
- 三阶段处理流程：下载 → 预览 → 解析
- 自动生成包含所有基因的汇总表格

### 2. 本地文件管理
- 上传本地 GenBank 文件进行解析
- 查看缓存的文件列表
- 批量下载所有处理结果（ZIP 格式）
- 支持 .gb、.genbank、.txt 格式

### 3. 直接登录号搜索
- 使用已知的基因组登录号（GCA_xxx.x 或 GCF_xxx.x）
- 搜索 NCBI 数据库获取组装信息
- 下载并解析选定的基因组
- 导出基因表格

## 安装和运行

### 系统要求
- Python 3.8 或更高版本
- 稳定的网络连接（用于访问 NCBI 和 KEGG 数据库）

### 安装步骤

1. 克隆或下载项目文件
2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 运行应用：
```bash
streamlit run main.py
```

## 使用指南

### KEGG 批量搜索工作流程

1. **输入生物名称**
   - 在 "Organism Name" 输入框中输入目标生物的学名
   - 例如：Clostridioides difficile

2. **设置参数**
   - Max Genomes：最多处理的基因组数量（1-20）
   - Include Sequences：是否包含 DNA 序列（会增加文件大小）

3. **阶段 1：批量下载**
   - 点击 "Stage 1: Batch Download GenBank Files"
   - 系统会从 KEGG 搜索基因组并下载对应的 GenBank 文件
   - 文件自动保存到本地项目文件夹

4. **阶段 2：预览结果**
   - 查看下载统计信息
   - 确认成功下载的文件数量和总基因数
   - 检查文件大小和详细信息

5. **阶段 3：批量解析**
   - 点击 "Stage 3: Batch Parse to Generate Table"
   - 系统解析所有下载的文件
   - 生成包含所有基因的 CSV 表格

### 本地文件管理

1. **上传文件**
   - 点击 "Select GenBank file" 按钮
   - 选择本地的 GenBank 文件
   - 点击 "Parse Uploaded File" 进行解析

2. **查看缓存**
   - 右侧显示所有缓存的文件
   - 包括 GenBank 原始文件和输出的 CSV 文件

3. **批量下载**
   - 点击 "Download All Files as ZIP"
   - 获取包含所有文件的压缩包

### 直接登录号搜索

1. **输入登录号**
   - 在输入框中输入基因组登录号
   - 格式：GCA_000005825.2 或 GCF_000005825.2

2. **搜索和选择**
   - 点击 "Search Genome" 搜索
   - 从结果列表中选择目标组装

3. **下载和提取**
   - 点击 "Download and Extract Genes"
   - 系统自动下载并解析基因信息
   - 生成可下载的 CSV 表格

## 文件存储设置

### 下载文件夹管理
- 默认使用系统下载文件夹
- 可自定义下载路径
- 支持一键重置为默认路径

### 项目文件夹结构
```
GenBank_Analysis_[项目名]/
├── genbank_files/    # 存储下载的 GenBank 文件
├── output/          # 存储生成的 CSV 结果
└── logs/           # 存储处理日志
```

## 输出格式

生成的 CSV 文件包含以下字段：
- **locus_tag**: 基因位点标签
- **gene**: 基因名称
- **product**: 基因产物描述
- **start/end**: 基因起止位置
- **strand**: DNA 链方向（+/-）
- **length**: 基因长度
- **protein_id**: 蛋白质 ID
- **ec_number**: 酶学委员会编号
- **feature_type**: 特征类型（gene/CDS）
- **sequence**: DNA 序列（可选）
- **translation**: 蛋白质序列（可选）

## 注意事项

1. **API 限制**
   - NCBI 和 KEGG 有访问频率限制
   - 程序内置了延迟机制避免超限
   - 大批量处理可能需要较长时间

2. **文件大小**
   - 包含序列信息会显著增加文件大小
   - 建议根据需要选择是否包含序列

3. **网络要求**
   - 需要稳定的网络连接
   - 部分地区可能需要配置代理

4. **错误处理**
   - 如遇到下载失败，可尝试重新运行
   - 检查网络连接和输入的登录号格式

## 常见问题

### Q: 为什么有些基因组下载失败？
A: 可能原因包括：
- GenBank 中没有对应的记录
- 网络连接问题
- API 访问限制

### Q: 如何处理大批量基因组？
A: 建议：
- 分批处理，每批不超过 10-20 个基因组
- 使用项目文件夹功能组织文件
- 定期备份处理结果

### Q: CSV 文件打开显示乱码？
A: 文件使用 UTF-8 编码，建议：
- 使用支持 UTF-8 的文本编辑器
- 在 Excel 中通过"数据导入"功能打开
- 指定编码为 UTF-8

## 技术支持

如遇到问题或需要新功能，请通过以下方式联系：
- 提交 Issue 到项目仓库
- 查看日志文件获取错误信息
- 确保使用最新版本的程序